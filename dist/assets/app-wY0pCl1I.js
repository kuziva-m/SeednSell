const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/listings-BGo343u5.js","assets/chat-Cz_rd05m.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const C="modulepreload",T=function(e){return"/"+e},S={},h=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){let a=function(l){return Promise.all(l.map(m=>Promise.resolve(m).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),f=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=a(n.map(l=>{if(l=T(l),l in S)return;S[l]=!0;const m=l.endsWith(".css"),g=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${g}`))return;const c=document.createElement("link");if(c.rel=m?"stylesheet":C,m||(c.as="script"),c.crossOrigin="",c.href=l,f&&c.setAttribute("nonce",f),document.head.appendChild(c),m)return new Promise((E,L)=>{c.addEventListener("load",E),c.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return o.then(a=>{for(const r of a||[])r.status==="rejected"&&s(r.reason);return t().catch(s)})},P={SUPABASE:{URL:"https://jupbwnbhxirfvsmrqiko.supabase.co",ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1cGJ3bmJoeGlyZnZzbXJxaWtvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjQ2OTksImV4cCI6MjA3NzcwMDY5OX0.ZIskD5R-E-hJVmUGTV8O3kGW70_iXoWtlFU3M_Xr5Gc"},COMPANY_USER_ID:"fb874327-31b0-4857-81e2-75f292bc21f6",IMAGES:{BUCKET:"product_images",MAX_SIZE_BYTES:5*1024*1024,ALLOWED_TYPES:["image/jpeg","image/png"]}},{createClient:O}=supabase,u=O(P.SUPABASE.URL,P.SUPABASE.ANON_KEY);let w=null,p=null,y=null,v=null;function M(){u.auth.onAuthStateChange((e,t)=>{if(console.log("Auth event:",e),t){p=t.user.id,document.dispatchEvent(new CustomEvent("auth:resolved",{detail:{userId:p}}));const n=document.getElementById("header-auth-section");if(n){n.innerHTML=`
          <div style="display: flex; align-items: center; gap: 15px;">
            <a href="/dashboard.html" class="user-avatar-btn" title="Go to Dashboard">
              <div class="avatar-circle">
                <i class="fa-solid fa-user"></i>
              </div>
              <span class="user-name-text" id="header-username">My Account</span>
            </a>
            <button id="header-logout-btn" class="action-icon" style="background: none; border: none; cursor: pointer; font-size: 1.2rem; padding: 5px;" title="Log Out">
              <i class="fa-solid fa-right-from-bracket" style="color: var(--danger-color);"></i>
            </button>
          </div>
        `;const i=document.getElementById("header-logout-btn");i&&i.addEventListener("click",()=>{const o=document.getElementById("logout-modal");o&&o.classList.add("is-visible")})}window.location.pathname.includes("auth.html")&&(window.location.href="/index.html"),x(p).then(i=>{w=i}),U(),D()}else{w=null,p=null,window.location.pathname.includes("dashboard.html")&&(window.location.href="/auth.html");const n=document.getElementById("header-auth-section");n&&(n.innerHTML='<a href="/auth.html" class="login-link">Login</a>'),y&&y.unsubscribe()}})}function k(){const e=document.getElementById("signup-form"),t=document.getElementById("login-form"),n=document.getElementById("signup-password"),i=document.getElementById("signup-phone");i&&window.intlTelInput&&(v=window.intlTelInput(i,{initialCountry:"zw",preferredCountries:["zw","za","zm","mz"],separateDialCode:!0,utilsScript:"https://cdn.jsdelivr.net/npm/intl-tel-input@18.2.1/build/js/utils.js"})),n&&n.addEventListener("input",o=>{const s=o.target.value,a=e?e.querySelector("button"):null;s.length>0&&s.length<6?(o.target.style.borderColor="var(--danger-color)",d("Password is too short (min 6 chars)","error"),a&&(a.disabled=!0)):(o.target.style.borderColor="#ccc",d("",""),a&&(a.disabled=!1))}),e&&e.addEventListener("submit",async o=>{o.preventDefault();const s=e.querySelector("button[type='submit']");if(v){if(!v.isValidNumber()){d("Please enter a valid phone number.","error"),i.style.borderColor="var(--danger-color)";return}const b=v.getNumber();i.value=b}const a=document.getElementById("signup-email");if(!N(a.value)){d("Please enter a valid email address.","error"),a.style.borderColor="var(--danger-color)";return}s.disabled=!0,s.innerHTML='<span class="spinner"></span>Creating Account...';const r=a.value,f=document.getElementById("signup-password").value,l=document.getElementById("signup-name").value,m=i.value,g=document.getElementById("signup-city").value,c=document.getElementById("signup-area").value;document.getElementById("signup-entity-type").value;const E=document.getElementById("signup-role").value,L=`${g}, ${c}`,{data:B,error:_}=await u.auth.signUp({email:r,password:f});if(_){d(_.message,"error"),s.disabled=!1,s.innerHTML="Sign Up";return}if(B.user){const{error:b}=await u.from("profiles").insert({id:B.user.id,full_name:l,phone_number:m,location:L,user_role:E});b?(console.error("Profile save error:",b),d("Sign up successful, but profile saving failed.","error"),s.disabled=!1,s.innerHTML="Sign Up"):(d("Sign up successful! Redirecting...","success"),window.location.href="/index.html")}}),t&&t.addEventListener("submit",async o=>{o.preventDefault();const s=t.querySelector("button[type='submit']");s.disabled=!0,s.innerHTML='<span class="spinner"></span>Logging In...';const a=document.getElementById("login-email").value,r=document.getElementById("login-password").value,{error:f}=await u.auth.signInWithPassword({email:a,password:r});f?(d(f.message,"error"),s.disabled=!1,s.innerHTML="Log In"):(d("Login successful! Redirecting...","success"),window.location.href="/index.html")})}async function x(e){const{data:t,error:n}=await u.from("profiles").select("*").eq("id",e).single();if(!n)return t}async function U(){const e=await u.auth.getUser();if(!e.data.user)return;const{data:t}=await u.rpc("get_room_unread_counts",{p_user_id:e.data.user.id});if(t&&t.length>0){const n=document.getElementById("notification-bubble"),i=document.getElementById("bottom-nav-bubble");n&&n.classList.add("active"),i&&i.classList.add("active")}}function D(){const e=I();!e||y||(y=u.channel("public:chat_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`receiver_id=eq.${e}`},()=>{const t=document.getElementById("notification-bubble"),n=document.getElementById("bottom-nav-bubble");t&&t.classList.add("active"),n&&n.classList.add("active")}).subscribe())}function d(e,t){const n=document.getElementById("auth-message");n&&(n.textContent=e,n.className=t)}function N(e){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(String(e).toLowerCase())}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("logout-modal"),t=document.getElementById("logout-cancel-btn"),n=document.getElementById("logout-confirm-btn");e&&t&&n&&(t.addEventListener("click",()=>e.classList.remove("is-visible")),e.addEventListener("click",i=>{i.target===e&&e.classList.remove("is-visible")}),n.addEventListener("click",async()=>{await u.auth.signOut(),window.location.href="/index.html"}))});const I=()=>p,q=()=>w;function R(){const e=document.querySelectorAll(".fade-in-section");if(e.length===0)return;const t={root:null,rootMargin:"0px",threshold:.1},n=(o,s)=>{o.forEach(a=>{a.isIntersecting&&(a.target.classList.add("is-visible"),s.unobserve(a.target))})},i=new IntersectionObserver(n,t);e.forEach(o=>{i.observe(o)})}function W(){const e=document.querySelector("header");e&&window.addEventListener("scroll",()=>{window.scrollY>10?e.classList.add("is-scrolled"):e.classList.remove("is-scrolled")})}function $(){const e=document.querySelector(".mobile-nav-toggle"),t=document.getElementById("primary-navigation");if(!e||!t)return;e.addEventListener("click",()=>{const a=t.classList.contains("is-open");e.setAttribute("aria-expanded",!a),t.classList.toggle("is-open"),document.body.classList.toggle("nav-open")});const n=t.querySelectorAll("a");n.forEach(a=>{a.addEventListener("click",()=>{t.classList.contains("is-open")&&(e.setAttribute("aria-expanded",!1),t.classList.remove("is-open"),document.body.classList.remove("nav-open"))})});const i=t.querySelector(".magic-line"),o=t.querySelector("a.active");if(!i||!n.length)return;function s(a){if(!a){i.style.width="0px";return}i.style.left=`${a.offsetLeft}px`,i.style.width=`${a.offsetWidth}px`}s(o),n.forEach(a=>{a.addEventListener("mouseover",()=>s(a))}),t.addEventListener("mouseleave",()=>s(o))}async function H(){const e=document.getElementById("global-header"),t=document.getElementById("global-footer"),n=document.getElementById("global-mobile-nav"),i=[];e&&i.push(fetch("/components/header.html").then(o=>o.text()).then(o=>{e.innerHTML=o;const a=new URLSearchParams(window.location.search).get("cat")||"produce",r=e.querySelector(`.nav-pill[href*="cat=${a}"]`);r&&r.classList.add("active")})),t&&i.push(fetch("/components/footer.html").then(o=>o.text()).then(o=>{t.innerHTML=o})),n&&i.push(fetch("/components/mobile-nav.html").then(o=>o.text()).then(o=>{n.innerHTML=o;const s=window.location.pathname,a=n.querySelector(`.nav-item[href="${s}"]`);a&&a.classList.add("active")})),await Promise.all(i)}function z(){const e="G-WCRTQLKDC6";if(document.getElementById("ga-script"))return;const t=document.createElement("script");t.id="ga-script",t.async=!0,t.src=`https://www.googletagmanager.com/gtag/js?id=${e}`,document.head.appendChild(t),window.dataLayer=window.dataLayer||[];function n(){window.dataLayer.push(arguments)}window.gtag=n,n("js",new Date),n("config",e),console.log(`Analytics initialized: ${e}`)}async function j(){z(),await H(),M(),R(),$(),W(),J()}j();document.addEventListener("click",e=>{const t=e.target.closest("#mobile-menu-btn"),n=e.target.closest("#close-menu-btn"),i=document.getElementById("mobile-menu-overlay");t&&i&&(t.setAttribute("aria-expanded","true"),G(),i.classList.add("is-visible")),n&&i&&(i.classList.remove("is-visible"),A()),e.target===i&&(i.classList.remove("is-visible"),A()),e.target.closest(".protected-link")&&(I()||(e.preventDefault(),window.location.href="/auth.html"))});function A(){const e=document.getElementById("mobile-menu-btn");e&&e.setAttribute("aria-expanded","false")}function G(){const e=I(),t=q(),n=document.getElementById("menu-user-name"),i=document.getElementById("menu-auth-link");if(e){if(n.textContent=`Hi, ${(t==null?void 0:t.full_name)||"Farmer"}`,i&&(i.href="/dashboard.html",i.innerHTML='<i class="fa-solid fa-user"></i> My Dashboard'),!document.getElementById("menu-logout")){const o=document.querySelector(".mobile-menu-links");if(o){const s=document.createElement("a");s.id="menu-logout",s.href="#",s.className="menu-link",s.style.color="var(--danger-color)",s.innerHTML='<i class="fa-solid fa-right-from-bracket"></i> Log Out',s.onclick=a=>{a.preventDefault();const r=document.getElementById("logout-modal");r&&r.classList.add("is-visible"),document.getElementById("mobile-menu-overlay").classList.remove("is-visible")},o.appendChild(s)}}}else{n.textContent="Welcome, Guest",i&&(i.href="/auth.html",i.innerHTML='<i class="fa-solid fa-right-to-bracket"></i> Login / Sign Up');const o=document.getElementById("menu-logout");o&&o.remove()}}if("serviceWorker"in navigator){let e=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{e||(e=!0,window.location.reload())})}async function J(){const e=window.location.pathname;try{if(e.endsWith("/")||e.endsWith("/index.html")){const{initListingsPage:t}=await h(async()=>{const{initListingsPage:i}=await import("./listings-BGo343u5.js");return{initListingsPage:i}},__vite__mapDeps([0,1])),{initToggleSlider:n}=await h(async()=>{const{initToggleSlider:i}=await import("./toggle-B7ZfKfrR.js");return{initToggleSlider:i}},[]);t(),n()}else if(e.endsWith("/listing.html")){const{initListingDetailPage:t}=await h(async()=>{const{initListingDetailPage:n}=await import("./listings-BGo343u5.js");return{initListingDetailPage:n}},__vite__mapDeps([0,1]));t()}else if(e.endsWith("/dashboard.html")){const{initDashboardPage:t}=await h(async()=>{const{initDashboardPage:n}=await import("./dashboard-C0Q5-MZ-.js");return{initDashboardPage:n}},[]);t()}else if(e.endsWith("/messages.html")){const{initChatPage:t}=await h(async()=>{const{initChatPage:n}=await import("./chat-Cz_rd05m.js");return{initChatPage:n}},[]);t()}else e.endsWith("/auth.html")&&k()}catch(t){console.error("Page logic error:",t)}}window.showToast=function(e,t="info"){let n=document.getElementById("toast-container");n||(n=document.createElement("div"),n.id="toast-container",document.body.appendChild(n));const i=document.createElement("div");i.className=`toast ${t}`;let o=t==="success"?"fa-circle-check":t==="error"?"fa-triangle-exclamation":"fa-circle-info";i.innerHTML=`<i class="fa-solid ${o}"></i> <span>${e}</span>`,n.appendChild(i),setTimeout(()=>{i.style.animation="fadeOutToast 0.3s forwards",i.addEventListener("animationend",()=>i.remove())},4e3)};export{P as C,I as a,D as b,U as c,q as g,u as s};
