import{s as P,C as G,g as j,a as U}from"./app-Cz4uy1Bm.js";import{handleStartChat as q}from"./chat-BHGKrE-4.js";const Y=document.getElementById("featured-listings-grid"),A=document.getElementById("featured-loading-message"),_=document.getElementById("listings-grid-content"),F=document.getElementById("loading-message"),p=document.getElementById("listing-detail-container");document.getElementById("search-form");document.getElementById("search-input");document.getElementById("location-input");const O=document.getElementById("load-more-btn"),u=document.getElementById("breadcrumb-container");let g="produce";const E={produce:{theme:"theme-produce",title:"Recruiting Producers!",desc:"We are verifying farmers now. Register to have your produce listed here when we launch.",btnText:"Register Now",unitDefault:"crate",promo:{bgImage:"/images/field.webp",left:{title:'<i class="fa-solid fa-truck-ramp-box icon"></i>Are You a Large-Scale Buyer?',desc:"Secure your supply chain early. Contract farmers before the harvest season begins.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-tractor icon"></i>Are You a Farmer?',desc:"Don't get left behind. Join our Contract Program and get verified today.",btn:"Join Our Program"}}},inputs:{theme:"theme-inputs",title:"Recruiting Input Suppliers.",desc:"Do you sell fertilizer, seeds, or chemicals? Register now to reach thousands of farmers.",btnText:"Register as Supplier",unitDefault:"bag",promo:{bgImage:"/images/promo-inputs.jpg",left:{title:'<i class="fa-solid fa-shop icon"></i>Bulk Orders Coming Soon',desc:"We are aggregating orders from our farmers. Be the first supplier they call.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-hand-holding-dollar icon"></i>Sell Your Inputs',desc:"Create your verified profile today so you are ready when the season starts.",btn:"Register Now"}}},services:{theme:"theme-services",title:"Recruiting Service Providers.",desc:"Tractor owners, transporters, and vets: Get verified now to receive job alerts.",btnText:"Register Service",unitDefault:"job",promo:{bgImage:"/images/promo-services.jpg",left:{title:'<i class="fa-solid fa-clipboard-list icon"></i>Need Work Done?',desc:"We are building a database of verified service providers. Check back soon.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-wrench icon"></i>List Your Machinery',desc:"Turn your idle equipment into cash. Register your tractor or truck today.",btn:"Register Now"}}}},K=[{id:"mock-1",product_name:"Fresh Tomatoes (Example)",price:15,location:"Harare",main_image_url:null,category:"produce"},{id:"mock-2",product_name:"Choice Maize (Example)",price:5,location:"Bindura",main_image_url:null,category:"produce"},{id:"mock-3",product_name:"Compound D Fertilizer (Example)",price:38,location:"Msasa",main_image_url:null,category:"inputs"},{id:"mock-4",product_name:"Tractor Ploughing (Example)",price:90,location:"Marondera",main_image_url:null,category:"services"},{id:"mock-5",product_name:"Road Runner Chickens (Example)",price:6,location:"Gweru",main_image_url:null,category:"produce"},{id:"mock-6",product_name:"Veterinary Services (Example)",price:50,location:"Bulawayo",main_image_url:null,category:"services"}];function z(e,i,t,s=null,c=null){e.innerHTML="";const n=document.createElement("div");n.className="empty-state fade-in-section is-visible";const d=document.createElement("i");d.className="fa-solid fa-basket-shopping";const r=document.createElement("h3");r.textContent=i;const l=document.createElement("p");if(l.textContent=t,n.appendChild(d),n.appendChild(r),n.appendChild(l),s&&c){const o=document.createElement("button");o.className="btn btn-primary",o.textContent=s,o.onclick=c,n.appendChild(o)}e.appendChild(n)}async function te(){if(!_)return;const i=new URLSearchParams(window.location.search).get("cat");i&&E[i]?g=i:g="produce",console.log("Initializing listings for category: ".concat(g)),J(),Q(),Y&&X(),V()}function J(){const e=E[g];document.body.classList.remove("theme-produce","theme-inputs","theme-services"),e.theme&&document.body.classList.add(e.theme),document.querySelectorAll(".nav-pill").forEach(n=>{n.classList.remove("active"),n.href.includes("cat=".concat(g))&&n.classList.add("active")});const i=document.getElementById("hero-title"),t=document.getElementById("hero-desc"),s=document.getElementById("hero-browse-btn");i&&(i.textContent=e.title),t&&(t.textContent=e.desc),s&&(s.textContent=e.btnText);const c=document.getElementById("promo-section");if(c&&e.promo){c.style.backgroundImage="url('".concat(e.promo.bgImage,"')");const n=document.getElementById("promo-left-title"),d=document.getElementById("promo-left-desc"),r=document.getElementById("promo-left-btn");n&&(n.innerHTML=e.promo.left.title),d&&(d.textContent=e.promo.left.desc),r&&(r.textContent=e.promo.left.btn,e.promo.left.btn.includes("+263")?(r.href="https://wa.me/263785141781",r.target="_blank"):(r.href="/contact.html",r.target=""));const l=document.getElementById("promo-right-title"),o=document.getElementById("promo-right-desc"),f=document.getElementById("promo-right-btn");l&&(l.innerHTML=e.promo.right.title),o&&(o.textContent=e.promo.right.desc),f&&(f.textContent=e.promo.right.btn)}}async function Q(){const e=document.getElementById("location-input");if(!e)return;e.innerHTML="";const i=document.createElement("option");i.value="",i.textContent="All Locations",e.appendChild(i)}function V(){F&&(F.style.display="none"),O&&(O.style.display="none");const e=K.filter(i=>i.category===g);if(e.length===0){z(_,"No Examples Yet","Check back soon as we verify our first partners.");return}_.innerHTML="",e.forEach(i=>{const t=document.createElement("article");t.className="listing-card fade-in-section is-visible";const s=document.createElement("a");s.href="/auth.html",s.className="listing-card-link";const c=document.createElement("img");c.src="/images/logo.webp",c.alt=i.product_name,c.style.objectFit="contain",c.style.padding="20px",c.style.backgroundColor="#f9f9f9";const n=document.createElement("div");n.className="listing-card-content";const d=document.createElement("h3");d.textContent=i.product_name;const r=document.createElement("p");r.className="price";const l=E[g];r.textContent="$".concat(i.price," / ").concat(l.unitDefault);const o=document.createElement("div");o.style.backgroundColor="#ffc107",o.style.color="#333",o.style.fontSize="0.75rem",o.style.fontWeight="700",o.style.padding="4px 8px",o.style.borderRadius="4px",o.style.display="inline-block",o.style.marginBottom="8px",o.textContent="EXAMPLE: Register to Feature",n.appendChild(o),n.appendChild(d),n.appendChild(r),s.appendChild(c),s.appendChild(n),t.appendChild(s),_.appendChild(t)})}async function X(){A&&(A.style.display="none"),z(Y,"Bulk Supply","Recruiting verified bulk suppliers. Contact us to apply.")}async function ne(){var c;if(!p)return;const i=new URLSearchParams(window.location.search).get("id");if(!i){p.innerHTML='<p class="error">Listing not found. <a href="index.html">Go home</a>.</p>';return}const{data:t,error:s}=await P.from("listings").select("*, profiles ( id, full_name )").eq("id",i).single();if(s){p.innerHTML='<p class="error">Error loading listing.</p>';return}if(t){document.title="".concat(t.product_name," - Seed & Sell");const n=t.category||"produce",r=(E[n]||E.produce).unitDefault;if(u){u.innerHTML="";const a=document.createElement("a");a.href="index.html?cat=".concat(n),a.textContent="Home";const y=document.createTextNode(" > "),M=document.createElement("a");M.href="index.html?cat=".concat(n,"#marketplace-container"),M.textContent=n.charAt(0).toUpperCase()+n.slice(1);const W=document.createTextNode(" > "),R=document.createElement("span");R.className="current",R.textContent=t.product_name,u.appendChild(a),u.appendChild(y),u.appendChild(M),u.appendChild(W),u.appendChild(R)}const l=U(),o=l&&l===t.farmer_id;p.innerHTML="";const f=document.createElement("div");f.className="listing-detail-image-wrapper";const m=document.createElement("img");if(m.id="listing-image",t.main_image_url)try{const a=t.main_image_url.split("/".concat(G.IMAGES.BUCKET,"/"))[1];if(a){const{data:y}=P.storage.from(G.IMAGES.BUCKET).getPublicUrl(a,{transform:{width:800,height:600,resize:"cover"}});m.src=y.publicUrl}else m.src=t.main_image_url}catch(a){m.src="/images/logo.webp"}else m.src="/images/logo.webp";m.alt=t.product_name,f.appendChild(m);const h=document.createElement("div");h.className="listing-detail-info";const T=document.createElement("h2");T.id="listing-title",T.textContent=t.product_name;const w=document.createElement("p");w.id="listing-price",w.textContent="$".concat(t.price," / ").concat(r);const b=document.createElement("div");b.className="listing-meta-group";const x=document.createElement("p");x.className="listing-meta-item",x.innerHTML='<i class="fa-solid fa-cubes"></i>';const B=document.createElement("span");B.innerHTML="<strong>Available:</strong> ",B.appendChild(document.createTextNode("".concat(t.quantity_available||"Not specified"," ").concat(r,"s"))),x.appendChild(B);const v=document.createElement("p");v.className="listing-meta-item",v.innerHTML='<i class="fa-solid fa-location-dot"></i>';const N=document.createElement("span");N.innerHTML="<strong>Location:</strong> ",N.appendChild(document.createTextNode(t.location)),v.appendChild(N),b.appendChild(x),b.appendChild(v);const I=document.createElement("div");I.className="listing-description-card";const D=document.createElement("h3");D.textContent="Description";const H=document.createElement("p");H.textContent=t.description||"No description provided.",I.appendChild(D),I.appendChild(H),h.appendChild(T),h.appendChild(w),h.appendChild(b),h.appendChild(I);const k=document.createElement("div");k.className="listing-detail-sidebar";const C=document.createElement("div");C.className="farmer-details-card";const $=document.createElement("h3");$.textContent="Seller Details";const L=document.createElement("p");L.className="listing-meta-item",L.innerHTML='<i class="fa-solid fa-user"></i>';const S=document.createElement("span");if(S.innerHTML="<strong>Contact:</strong> ",S.appendChild(document.createTextNode(((c=t.profiles)==null?void 0:c.full_name)||"Unknown")),L.appendChild(S),C.appendChild($),C.appendChild(L),o){const a=document.createElement("a");a.href="/dashboard.html?edit_id=".concat(t.id),a.className="btn btn-primary btn-full-width",a.textContent="Edit Your Listing",C.appendChild(a)}else{const a=document.createElement("button");a.className="btn btn-primary btn-full-width",a.textContent="Chat with Seller",a.onclick=()=>{const y=j();if(!y)return alert("Please log in as a Buyer to chat.");if(y.user_role==="farmer"&&n==="produce")return alert("Farmers cannot chat with other farmers.");q(t.profiles.id,U())},C.appendChild(a)}k.appendChild(C),p.appendChild(f),p.appendChild(h),p.appendChild(k)}}export{ne as initListingDetailPage,te as initListingsPage};
