const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/listings-DWRPq-Qh.js","assets/chat-C4MMBOhm.js"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();const B="modulepreload",S=function(e){return"/"+e},w={},h=function(t,i,o){let n=Promise.resolve();if(i&&i.length>0){let r=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),b=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=r(i.map(c=>{if(c=S(c),c in w)return;w[c]=!0;const u=c.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const l=document.createElement("link");if(l.rel=u?"stylesheet":B,u||(l.as="script"),l.crossOrigin="",l.href=c,b&&l.setAttribute("nonce",b),document.head.appendChild(l),u)return new Promise((p,E)=>{l.addEventListener("load",p),l.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return n.then(r=>{for(const a of r||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})},_={SUPABASE:{URL:"https://jupbwnbhxirfvsmrqiko.supabase.co",ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1cGJ3bmJoeGlyZnZzbXJxaWtvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjQ2OTksImV4cCI6MjA3NzcwMDY5OX0.ZIskD5R-E-hJVmUGTV8O3kGW70_iXoWtlFU3M_Xr5Gc"},COMPANY_USER_ID:"fb874327-31b0-4857-81e2-75f292bc21f6",IMAGES:{BUCKET:"product_images",MAX_SIZE_BYTES:5*1024*1024,ALLOWED_TYPES:["image/jpeg","image/png"]}},{createClient:P}=supabase,d=P(_.SUPABASE.URL,_.SUPABASE.ANON_KEY);let L=null,v=null,y=null;function A(){d.auth.onAuthStateChange((e,t)=>{if(console.log("Auth event:",e),t){v=t.user.id;const i=document.getElementById("header-auth-section");if(i){i.innerHTML=`
          <div style="display: flex; align-items: center; gap: 15px;">
            <a href="/dashboard.html" class="user-avatar-btn" title="Go to Dashboard">
              <div class="avatar-circle">
                <i class="fa-solid fa-user"></i>
              </div>
              <span class="user-name-text" id="header-username">My Account</span>
            </a>
            <button id="header-logout-btn" class="action-icon" style="background: none; border: none; cursor: pointer; font-size: 1.2rem; padding: 5px;" title="Log Out">
              <i class="fa-solid fa-right-from-bracket" style="color: var(--danger-color);"></i>
            </button>
          </div>
        `;const o=document.getElementById("header-logout-btn");o&&o.addEventListener("click",()=>{const n=document.getElementById("logout-modal");n&&n.classList.add("is-visible")})}window.location.pathname.includes("auth.html")&&(window.location.href="/index.html"),T(v).then(o=>{L=o}),k(),C()}else{L=null,v=null,window.location.pathname.includes("dashboard.html")&&(window.location.href="/auth.html");const i=document.getElementById("header-auth-section");i&&(i.innerHTML='<a href="/auth.html" class="login-link">Login</a>'),y&&y.unsubscribe()}})}function O(){const e=document.getElementById("signup-form"),t=document.getElementById("login-form"),i=document.getElementById("signup-password");i&&i.addEventListener("input",o=>{const n=o.target.value,s=e?e.querySelector("button"):null;n.length>0&&n.length<6?(o.target.style.borderColor="var(--danger-color)",g("Password is too short (min 6 chars)","error"),s&&(s.disabled=!0)):(o.target.style.borderColor="#ccc",g("",""),s&&(s.disabled=!1))}),e&&e.addEventListener("submit",async o=>{o.preventDefault();const n=e.querySelector("button[type='submit']");n.disabled=!0,n.innerHTML='<span class="spinner"></span>Creating Account...';const s=document.getElementById("signup-email").value,r=document.getElementById("signup-password").value,a=document.getElementById("signup-name").value,b=document.getElementById("signup-phone").value,c=document.getElementById("signup-location").value,u=document.getElementById("signup-role").value,f=M(b),{data:l,error:p}=await d.auth.signUp({email:s,password:r});if(p){g(p.message,"error"),n.disabled=!1,n.innerHTML="Sign Up";return}if(l.user){const{error:E}=await d.from("profiles").insert({id:l.user.id,full_name:a,phone_number:f,location:c,user_role:u});E?(g("Sign up successful, but profile saving failed.","error"),n.disabled=!1,n.innerHTML="Sign Up"):(g("Sign up successful! Redirecting...","success"),window.location.href="/index.html")}}),t&&t.addEventListener("submit",async o=>{o.preventDefault();const n=t.querySelector("button[type='submit']");n.disabled=!0,n.innerHTML='<span class="spinner"></span>Logging In...';const s=document.getElementById("login-email").value,r=document.getElementById("login-password").value,{error:a}=await d.auth.signInWithPassword({email:s,password:r});a?(g(a.message,"error"),n.disabled=!1,n.innerHTML="Log In"):(g("Login successful! Redirecting...","success"),window.location.href="/index.html")})}async function T(e){const{data:t,error:i}=await d.from("profiles").select("*").eq("id",e).single();if(!i)return t}async function k(){const e=await d.auth.getUser();if(!e.data.user)return;const{data:t}=await d.rpc("get_room_unread_counts",{p_user_id:e.data.user.id});if(t&&t.length>0){const i=document.getElementById("notification-bubble"),o=document.getElementById("bottom-nav-bubble");i&&i.classList.add("active"),o&&o.classList.add("active")}}function C(){const e=I();!e||y||(y=d.channel("public:chat_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`receiver_id=eq.${e}`},()=>{const t=document.getElementById("notification-bubble"),i=document.getElementById("bottom-nav-bubble");t&&t.classList.add("active"),i&&i.classList.add("active")}).subscribe())}function g(e,t){const i=document.getElementById("auth-message");i&&(i.textContent=e,i.className=t)}function M(e){let t=e.replace(/\D/g,"");return t.startsWith("0")&&(t=t.substring(1)),t.startsWith("263")||(t="263"+t),"+"+t}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("logout-modal"),t=document.getElementById("logout-cancel-btn"),i=document.getElementById("logout-confirm-btn");e&&t&&i&&(t.addEventListener("click",()=>e.classList.remove("is-visible")),e.addEventListener("click",o=>{o.target===e&&e.classList.remove("is-visible")}),i.addEventListener("click",async()=>{await d.auth.signOut(),window.location.href="/index.html"}))});const I=()=>v,x=()=>L;function U(){const e=document.querySelectorAll(".fade-in-section");if(e.length===0)return;const t={root:null,rootMargin:"0px",threshold:.1},i=(n,s)=>{n.forEach(r=>{r.isIntersecting&&(r.target.classList.add("is-visible"),s.unobserve(r.target))})},o=new IntersectionObserver(i,t);e.forEach(n=>{o.observe(n)})}function D(){const e=document.querySelector("header");e&&window.addEventListener("scroll",()=>{window.scrollY>10?e.classList.add("is-scrolled"):e.classList.remove("is-scrolled")})}function N(){const e=document.querySelector(".mobile-nav-toggle"),t=document.getElementById("primary-navigation");if(!e||!t)return;e.addEventListener("click",()=>{const r=t.classList.contains("is-open");e.setAttribute("aria-expanded",!r),t.classList.toggle("is-open"),document.body.classList.toggle("nav-open")});const i=t.querySelectorAll("a");i.forEach(r=>{r.addEventListener("click",()=>{t.classList.contains("is-open")&&(e.setAttribute("aria-expanded",!1),t.classList.remove("is-open"),document.body.classList.remove("nav-open"))})});const o=t.querySelector(".magic-line"),n=t.querySelector("a.active");if(!o||!i.length)return;function s(r){if(!r){o.style.width="0px";return}o.style.left=`${r.offsetLeft}px`,o.style.width=`${r.offsetWidth}px`}s(n),i.forEach(r=>{r.addEventListener("mouseover",()=>s(r))}),t.addEventListener("mouseleave",()=>s(n))}A();U();N();D();document.addEventListener("click",e=>{const t=e.target.closest("#mobile-menu-btn"),i=e.target.closest("#close-menu-btn"),o=document.getElementById("mobile-menu-overlay");t&&o&&(W(),o.classList.add("is-visible")),i&&o&&o.classList.remove("is-visible"),e.target===o&&o.classList.remove("is-visible"),e.target.closest(".protected-link")&&(I()||(e.preventDefault(),window.location.href="/auth.html"))});function W(){const e=I(),t=x(),i=document.getElementById("menu-user-name"),o=document.getElementById("menu-auth-link");if(e){if(i.textContent=`Hi, ${(t==null?void 0:t.full_name)||"Farmer"}`,o&&(o.href="/dashboard.html",o.innerHTML='<i class="fa-solid fa-user"></i> My Dashboard'),!document.getElementById("menu-logout")){const n=document.querySelector(".mobile-menu-links");if(n){const s=document.createElement("a");s.id="menu-logout",s.href="#",s.className="menu-link",s.style.color="var(--danger-color)",s.innerHTML='<i class="fa-solid fa-right-from-bracket"></i> Log Out',s.onclick=r=>{r.preventDefault();const a=document.getElementById("logout-modal");a&&a.classList.add("is-visible"),document.getElementById("mobile-menu-overlay").classList.remove("is-visible")},n.appendChild(s)}}}else{i.textContent="Welcome, Guest",o&&(o.href="/auth.html",o.innerHTML='<i class="fa-solid fa-right-to-bracket"></i> Login / Sign Up');const n=document.getElementById("menu-logout");n&&n.remove()}}const m=window.location.pathname;document.querySelectorAll(".mobile-bottom-nav .nav-item").forEach(e=>{const t=e.getAttribute("href");(t===m||m==="/"&&t&&t.includes("index.html"))&&e.classList.add("active")});if("serviceWorker"in navigator){let e=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{e||(e=!0,window.location.reload())})}async function q(){try{if(m.endsWith("/")||m.endsWith("/index.html")){const{initListingsPage:e}=await h(async()=>{const{initListingsPage:i}=await import("./listings-DWRPq-Qh.js");return{initListingsPage:i}},__vite__mapDeps([0,1])),{initToggleSlider:t}=await h(async()=>{const{initToggleSlider:i}=await import("./toggle-B7ZfKfrR.js");return{initToggleSlider:i}},[]);e(),t()}else if(m.endsWith("/listing.html")){const{initListingDetailPage:e}=await h(async()=>{const{initListingDetailPage:t}=await import("./listings-DWRPq-Qh.js");return{initListingDetailPage:t}},__vite__mapDeps([0,1]));e()}else if(m.endsWith("/dashboard.html")){const{initDashboardPage:e}=await h(async()=>{const{initDashboardPage:t}=await import("./dashboard-D7pDOCyj.js");return{initDashboardPage:t}},[]);e()}else if(m.endsWith("/messages.html")){const{initChatPage:e}=await h(async()=>{const{initChatPage:t}=await import("./chat-C4MMBOhm.js");return{initChatPage:t}},[]);e()}else m.endsWith("/auth.html")&&O()}catch(e){console.error("Page logic error:",e)}}q();window.showToast=function(e,t="info"){let i=document.getElementById("toast-container");i||(i=document.createElement("div"),i.id="toast-container",document.body.appendChild(i));const o=document.createElement("div");o.className=`toast ${t}`;let n=t==="success"?"fa-circle-check":t==="error"?"fa-triangle-exclamation":"fa-circle-info";o.innerHTML=`<i class="fa-solid ${n}"></i> <span>${e}</span>`,i.appendChild(o),setTimeout(()=>{o.style.animation="fadeOutToast 0.3s forwards",o.addEventListener("animationend",()=>o.remove())},4e3)};export{_ as C,I as a,C as b,k as c,x as g,d as s};
