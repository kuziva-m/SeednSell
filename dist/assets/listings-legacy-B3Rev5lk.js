System.register(["./app-legacy-CZVEl_fd.js","./chat-legacy-BDj4jSrN.js"],function(e,t){"use strict";var n,i,o,a,r;return{setters:[e=>{n=e.s,i=e.C,o=e.g,a=e.a},e=>{r=e.handleStartChat}],execute:function(){e({initListingDetailPage:async function(){if(!d)return;const e=new URLSearchParams(window.location.search).get("id");if(!e)return void(d.innerHTML='<p class="error">Listing not found. <a href="index.html">Go home</a>.</p>');const{data:t,error:s}=await n.from("listings").select("*, profiles ( id, full_name )").eq("id",e).single();if(s)d.innerHTML='<p class="error">Error loading listing.</p>';else if(t){document.title=`${t.product_name} - Seed & Sell`;const e=t.category||"produce",s=(g[e]||g.produce).unitDefault;p&&(p.innerHTML=`<a href="index.html?cat=${e}">Home</a> &gt; <a href="index.html?cat=${e}#marketplace-container">${e.charAt(0).toUpperCase()+e.slice(1)}</a> &gt; <span class="current">${t.product_name}</span>`);const l=a(),m=l&&l===t.farmer_id;d.innerHTML="";const u=document.createElement("div");u.className="listing-detail-image-wrapper";const h=document.createElement("img");if(h.id="listing-image",t.main_image_url)try{const e=t.main_image_url.split(`/${i.IMAGES.BUCKET}/`)[1];if(e){const{data:t}=n.storage.from(i.IMAGES.BUCKET).getPublicUrl(e,{transform:{width:800,height:600,resize:"cover"}});h.src=t.publicUrl}else h.src=t.main_image_url}catch(c){h.src="/images/logo.webp"}else h.src="/images/logo.webp";h.alt=t.product_name,u.appendChild(h);const f=document.createElement("div");f.className="listing-detail-info";const y=document.createElement("h2");y.id="listing-title",y.textContent=t.product_name;const b=document.createElement("p");b.id="listing-price",b.textContent=`$${t.price} / ${s}`;const E=document.createElement("div");E.className="listing-meta-group",E.innerHTML=`\n      <p class="listing-meta-item"><i class="fa-solid fa-cubes"></i> <span><strong>Available:</strong> ${t.quantity_available||"Not specified"} ${s}s</span></p>\n      <p class="listing-meta-item"><i class="fa-solid fa-location-dot"></i> <span><strong>Location:</strong> ${t.location}</span></p>\n    `;const C=document.createElement("div");C.className="listing-description-card",C.innerHTML=`<h3>Description</h3><p>${t.description||"No description provided."}</p>`,f.appendChild(y),f.appendChild(b),f.appendChild(E),f.appendChild(C);const v=document.createElement("div");v.className="listing-detail-sidebar";const _=document.createElement("div");if(_.className="farmer-details-card",_.innerHTML=`<h3>Seller Details</h3><p class="listing-meta-item"><i class="fa-solid fa-user"></i> <span><strong>Contact:</strong> ${t.profiles?.full_name||"Unknown"}</span></p>`,m){const e=document.createElement("a");e.href=`/dashboard.html?edit_id=${t.id}`,e.className="btn btn-primary btn-full-width",e.textContent="Edit Your Listing",_.appendChild(e)}else{const n=document.createElement("button");n.className="btn btn-primary btn-full-width",n.textContent="Chat with Seller",n.onclick=()=>{const n=o();return n?"farmer"===n.user_role&&"produce"===e?alert("Farmers cannot chat with other farmers."):void r(t.profiles.id,a()):alert("Please log in as a Buyer to chat.")},_.appendChild(n)}v.appendChild(_),d.appendChild(u),d.appendChild(f),d.appendChild(v)}},initListingsPage:async function(){if(!c)return;const e=new URLSearchParams(window.location.search).get("cat");u=e&&g[e]?e:"produce",console.log(`Initializing listings for category: ${u}`),function(){const e=g[u];document.body.classList.remove("theme-produce","theme-inputs","theme-services"),e.theme&&document.body.classList.add(e.theme),document.querySelectorAll(".nav-pill").forEach(e=>{e.classList.remove("active"),e.href.includes(`cat=${u}`)&&e.classList.add("active")});const t=document.getElementById("hero-title"),n=document.getElementById("hero-desc"),i=document.getElementById("hero-browse-btn");t&&(t.textContent=e.title),n&&(n.textContent=e.desc),i&&(i.textContent=e.btnText);const o=document.getElementById("promo-section");if(o&&e.promo){o.style.backgroundImage=`url('${e.promo.bgImage}')`;const t=document.getElementById("promo-left-title"),n=document.getElementById("promo-left-desc"),i=document.getElementById("promo-left-btn");t&&(t.innerHTML=e.promo.left.title),n&&(n.textContent=e.promo.left.desc),i&&(i.textContent=e.promo.left.btn,e.promo.left.btn.includes("+263")?(i.href="https://wa.me/263785141781",i.target="_blank"):(i.href="/contact.html",i.target=""));const a=document.getElementById("promo-right-title"),r=document.getElementById("promo-right-desc"),s=document.getElementById("promo-right-btn");a&&(a.innerHTML=e.promo.right.title),r&&(r.textContent=e.promo.right.desc),s&&(s.textContent=e.promo.right.btn)}}(),async function(){const e=document.getElementById("location-input");e&&(e.innerHTML='<option value="">All Locations</option>')}(),t&&async function(){s&&(s.style.display="none"),f(t,"Bulk Supply","Recruiting verified bulk suppliers. Contact us to apply.")}(),function(){l&&(l.style.display="none"),m&&(m.style.display="none");const e=h.filter(e=>e.category===u);0!==e.length?(c.innerHTML="",e.forEach(e=>{const t=document.createElement("article");t.className="listing-card fade-in-section is-visible";const n=document.createElement("a");n.href="/auth.html",n.className="listing-card-link";const i=document.createElement("img");i.src="/images/logo.webp",i.alt=e.product_name,i.style.objectFit="contain",i.style.padding="20px",i.style.backgroundColor="#f9f9f9";const o=document.createElement("div");o.className="listing-card-content";const a=document.createElement("h3");a.textContent=e.product_name;const r=document.createElement("p");r.className="price";const s=g[u];r.textContent=`$${e.price} / ${s.unitDefault}`;const l=document.createElement("div");l.style.backgroundColor="#ffc107",l.style.color="#333",l.style.fontSize="0.75rem",l.style.fontWeight="700",l.style.padding="4px 8px",l.style.borderRadius="4px",l.style.display="inline-block",l.style.marginBottom="8px",l.textContent="EXAMPLE: Register to Feature",o.appendChild(l),o.appendChild(a),o.appendChild(r),n.appendChild(i),n.appendChild(o),t.appendChild(n),c.appendChild(t)})):f(c,"No Examples Yet","Check back soon as we verify our first partners.")}()}});const t=document.getElementById("featured-listings-grid"),s=document.getElementById("featured-loading-message"),c=document.getElementById("listings-grid-content"),l=document.getElementById("loading-message"),d=document.getElementById("listing-detail-container");document.getElementById("search-form"),document.getElementById("search-input"),document.getElementById("location-input");const m=document.getElementById("load-more-btn"),p=document.getElementById("breadcrumb-container");let u="produce";const g={produce:{theme:"theme-produce",title:"Recruiting Producers!",desc:"We are verifying farmers now. Register to have your produce listed here when we launch.",btnText:"Register Now",unitDefault:"crate",promo:{bgImage:"/images/field.webp",left:{title:'<i class="fa-solid fa-truck-ramp-box icon"></i>Are You a Large-Scale Buyer?',desc:"Secure your supply chain early. Contract farmers before the harvest season begins.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-tractor icon"></i>Are You a Farmer?',desc:"Don't get left behind. Join our Contract Program and get verified today.",btn:"Join Our Program"}}},inputs:{theme:"theme-inputs",title:"Recruiting Input Suppliers.",desc:"Do you sell fertilizer, seeds, or chemicals? Register now to reach thousands of farmers.",btnText:"Register as Supplier",unitDefault:"bag",promo:{bgImage:"/images/promo-inputs.jpg",left:{title:'<i class="fa-solid fa-shop icon"></i>Bulk Orders Coming Soon',desc:"We are aggregating orders from our farmers. Be the first supplier they call.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-hand-holding-dollar icon"></i>Sell Your Inputs',desc:"Create your verified profile today so you are ready when the season starts.",btn:"Register Now"}}},services:{theme:"theme-services",title:"Recruiting Service Providers.",desc:"Tractor owners, transporters, and vets: Get verified now to receive job alerts.",btnText:"Register Service",unitDefault:"job",promo:{bgImage:"/images/promo-services.jpg",left:{title:'<i class="fa-solid fa-clipboard-list icon"></i>Need Work Done?',desc:"We are building a database of verified service providers. Check back soon.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-wrench icon"></i>List Your Machinery',desc:"Turn your idle equipment into cash. Register your tractor or truck today.",btn:"Register Now"}}}},h=[{id:"mock-1",product_name:"Fresh Tomatoes (Example)",price:15,location:"Harare",main_image_url:null,category:"produce"},{id:"mock-2",product_name:"Choice Maize (Example)",price:5,location:"Bindura",main_image_url:null,category:"produce"},{id:"mock-3",product_name:"Compound D Fertilizer (Example)",price:38,location:"Msasa",main_image_url:null,category:"inputs"},{id:"mock-4",product_name:"Tractor Ploughing (Example)",price:90,location:"Marondera",main_image_url:null,category:"services"},{id:"mock-5",product_name:"Road Runner Chickens (Example)",price:6,location:"Gweru",main_image_url:null,category:"produce"},{id:"mock-6",product_name:"Veterinary Services (Example)",price:50,location:"Bulawayo",main_image_url:null,category:"services"}];function f(e,t,n,i=null,o=null){e.innerHTML="";const a=document.createElement("div");if(a.className="empty-state fade-in-section is-visible",a.innerHTML=`\n    <i class="fa-solid fa-basket-shopping"></i>\n    <h3>${t}</h3>\n    <p>${n}</p>\n  `,i&&o){const e=document.createElement("button");e.className="btn btn-primary",e.textContent=i,e.onclick=o,a.appendChild(e)}e.appendChild(a)}}}});
