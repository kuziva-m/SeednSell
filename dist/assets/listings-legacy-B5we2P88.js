System.register(["./app-legacy-DB7L6TtM.js","./chat-legacy-qfHA6jx8.js"],function(e,t){"use strict";var n,o,i,a,r;return{setters:[e=>{n=e.s,o=e.C,i=e.g,a=e.a},e=>{r=e.handleStartChat}],execute:function(){e({initListingDetailPage:async function(){if(!d)return;const e=new URLSearchParams(window.location.search).get("id");if(!e)return void(d.innerHTML='<p class="error">Listing not found. <a href="index.html">Go home</a>.</p>');const{data:t,error:c}=await n.from("listings").select("*, profiles ( id, full_name )").eq("id",e).single();if(c)d.innerHTML='<p class="error">Error loading listing.</p>';else if(t){document.title=`${t.product_name} - Seed & Sell`;const e=t.category||"produce",c=(g[e]||g.produce).unitDefault;if(p){p.innerHTML="";const n=document.createElement("a");n.href=`index.html?cat=${e}`,n.textContent="Home";const o=document.createTextNode(" > "),i=document.createElement("a");i.href=`index.html?cat=${e}#marketplace-container`,i.textContent=e.charAt(0).toUpperCase()+e.slice(1);const a=document.createTextNode(" > "),r=document.createElement("span");r.className="current",r.textContent=t.product_name,p.appendChild(n),p.appendChild(o),p.appendChild(i),p.appendChild(a),p.appendChild(r)}const s=a(),m=s&&s===t.farmer_id;d.innerHTML="";const u=document.createElement("div");u.className="listing-detail-image-wrapper";const h=document.createElement("img");if(h.id="listing-image",t.main_image_url)try{const e=t.main_image_url.split(`/${o.IMAGES.BUCKET}/`)[1];if(e){const{data:t}=n.storage.from(o.IMAGES.BUCKET).getPublicUrl(e,{transform:{width:800,height:600,resize:"cover"}});h.src=t.publicUrl}else h.src=t.main_image_url}catch(l){h.src="/images/logo.webp"}else h.src="/images/logo.webp";h.alt=t.product_name,u.appendChild(h);const f=document.createElement("div");f.className="listing-detail-info";const y=document.createElement("h2");y.id="listing-title",y.textContent=t.product_name;const C=document.createElement("p");C.id="listing-price",C.textContent=`$${t.price} / ${c}`;const E=document.createElement("div");E.className="listing-meta-group";const b=document.createElement("p");b.className="listing-meta-item",b.innerHTML='<i class="fa-solid fa-cubes"></i>';const x=document.createElement("span");x.innerHTML="<strong>Available:</strong> ",x.appendChild(document.createTextNode(`${t.quantity_available||"Not specified"} ${c}s`)),b.appendChild(x);const v=document.createElement("p");v.className="listing-meta-item",v.innerHTML='<i class="fa-solid fa-location-dot"></i>';const _=document.createElement("span");_.innerHTML="<strong>Location:</strong> ",_.appendChild(document.createTextNode(t.location)),v.appendChild(_),E.appendChild(b),E.appendChild(v);const w=document.createElement("div");w.className="listing-description-card";const B=document.createElement("h3");B.textContent="Description";const I=document.createElement("p");I.textContent=t.description||"No description provided.",w.appendChild(B),w.appendChild(I),f.appendChild(y),f.appendChild(C),f.appendChild(E),f.appendChild(w);const N=document.createElement("div");N.className="listing-detail-sidebar";const L=document.createElement("div");L.className="farmer-details-card";const T=document.createElement("h3");T.textContent="Seller Details";const k=document.createElement("p");k.className="listing-meta-item",k.innerHTML='<i class="fa-solid fa-user"></i>';const M=document.createElement("span");if(M.innerHTML="<strong>Contact:</strong> ",M.appendChild(document.createTextNode(t.profiles?.full_name||"Unknown")),k.appendChild(M),L.appendChild(T),L.appendChild(k),m){const e=document.createElement("a");e.href=`/dashboard.html?edit_id=${t.id}`,e.className="btn btn-primary btn-full-width",e.textContent="Edit Your Listing",L.appendChild(e)}else{const n=document.createElement("button");n.className="btn btn-primary btn-full-width",n.textContent="Chat with Seller",n.onclick=()=>{const n=i();return n?"farmer"===n.user_role&&"produce"===e?alert("Farmers cannot chat with other farmers."):void r(t.profiles.id,a()):alert("Please log in as a Buyer to chat.")},L.appendChild(n)}N.appendChild(L),d.appendChild(u),d.appendChild(f),d.appendChild(N)}},initListingsPage:async function(){if(!l)return;const e=new URLSearchParams(window.location.search).get("cat");u=e&&g[e]?e:"produce",console.log(`Initializing listings for category: ${u}`),function(){const e=g[u];document.body.classList.remove("theme-produce","theme-inputs","theme-services"),e.theme&&document.body.classList.add(e.theme),document.querySelectorAll(".nav-pill").forEach(e=>{e.classList.remove("active"),e.href.includes(`cat=${u}`)&&e.classList.add("active")});const t=document.getElementById("hero-title"),n=document.getElementById("hero-desc"),o=document.getElementById("hero-browse-btn");t&&(t.textContent=e.title),n&&(n.textContent=e.desc),o&&(o.textContent=e.btnText);const i=document.getElementById("promo-section");if(i&&e.promo){i.style.backgroundImage=`url('${e.promo.bgImage}')`;const t=document.getElementById("promo-left-title"),n=document.getElementById("promo-left-desc"),o=document.getElementById("promo-left-btn");t&&(t.innerHTML=e.promo.left.title),n&&(n.textContent=e.promo.left.desc),o&&(o.textContent=e.promo.left.btn,e.promo.left.btn.includes("+263")?(o.href="https://wa.me/263785141781",o.target="_blank"):(o.href="/contact.html",o.target=""));const a=document.getElementById("promo-right-title"),r=document.getElementById("promo-right-desc"),c=document.getElementById("promo-right-btn");a&&(a.innerHTML=e.promo.right.title),r&&(r.textContent=e.promo.right.desc),c&&(c.textContent=e.promo.right.btn)}}(),async function(){const e=document.getElementById("location-input");if(!e)return;e.innerHTML="";const t=document.createElement("option");t.value="",t.textContent="All Locations",e.appendChild(t)}(),t&&async function(){c&&(c.style.display="none"),f(t,"Bulk Supply","Recruiting verified bulk suppliers. Contact us to apply.")}(),function(){s&&(s.style.display="none"),m&&(m.style.display="none");const e=h.filter(e=>e.category===u);0!==e.length?(l.innerHTML="",e.forEach(e=>{const t=document.createElement("article");t.className="listing-card fade-in-section is-visible";const n=document.createElement("a");n.href="/auth.html",n.className="listing-card-link";const o=document.createElement("img");o.src="/images/logo.webp",o.alt=e.product_name,o.style.objectFit="contain",o.style.padding="20px",o.style.backgroundColor="#f9f9f9";const i=document.createElement("div");i.className="listing-card-content";const a=document.createElement("h3");a.textContent=e.product_name;const r=document.createElement("p");r.className="price";const c=g[u];r.textContent=`$${e.price} / ${c.unitDefault}`;const s=document.createElement("div");s.style.backgroundColor="#ffc107",s.style.color="#333",s.style.fontSize="0.75rem",s.style.fontWeight="700",s.style.padding="4px 8px",s.style.borderRadius="4px",s.style.display="inline-block",s.style.marginBottom="8px",s.textContent="EXAMPLE: Register to Feature",i.appendChild(s),i.appendChild(a),i.appendChild(r),n.appendChild(o),n.appendChild(i),t.appendChild(n),l.appendChild(t)})):f(l,"No Examples Yet","Check back soon as we verify our first partners.")}()}});const t=document.getElementById("featured-listings-grid"),c=document.getElementById("featured-loading-message"),l=document.getElementById("listings-grid-content"),s=document.getElementById("loading-message"),d=document.getElementById("listing-detail-container");document.getElementById("search-form"),document.getElementById("search-input"),document.getElementById("location-input");const m=document.getElementById("load-more-btn"),p=document.getElementById("breadcrumb-container");let u="produce";const g={produce:{theme:"theme-produce",title:"Recruiting Producers!",desc:"We are verifying farmers now. Register to have your produce listed here when we launch.",btnText:"Register Now",unitDefault:"crate",promo:{bgImage:"/images/field.webp",left:{title:'<i class="fa-solid fa-truck-ramp-box icon"></i>Are You a Large-Scale Buyer?',desc:"Secure your supply chain early. Contract farmers before the harvest season begins.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-tractor icon"></i>Are You a Farmer?',desc:"Don't get left behind. Join our Contract Program and get verified today.",btn:"Join Our Program"}}},inputs:{theme:"theme-inputs",title:"Recruiting Input Suppliers.",desc:"Do you sell fertilizer, seeds, or chemicals? Register now to reach thousands of farmers.",btnText:"Register as Supplier",unitDefault:"bag",promo:{bgImage:"/images/promo-inputs.jpg",left:{title:'<i class="fa-solid fa-shop icon"></i>Bulk Orders Coming Soon',desc:"We are aggregating orders from our farmers. Be the first supplier they call.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-hand-holding-dollar icon"></i>Sell Your Inputs',desc:"Create your verified profile today so you are ready when the season starts.",btn:"Register Now"}}},services:{theme:"theme-services",title:"Recruiting Service Providers.",desc:"Tractor owners, transporters, and vets: Get verified now to receive job alerts.",btnText:"Register Service",unitDefault:"job",promo:{bgImage:"/images/promo-services.jpg",left:{title:'<i class="fa-solid fa-clipboard-list icon"></i>Need Work Done?',desc:"We are building a database of verified service providers. Check back soon.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-wrench icon"></i>List Your Machinery',desc:"Turn your idle equipment into cash. Register your tractor or truck today.",btn:"Register Now"}}}},h=[{id:"mock-1",product_name:"Fresh Tomatoes (Example)",price:15,location:"Harare",main_image_url:null,category:"produce"},{id:"mock-2",product_name:"Choice Maize (Example)",price:5,location:"Bindura",main_image_url:null,category:"produce"},{id:"mock-3",product_name:"Compound D Fertilizer (Example)",price:38,location:"Msasa",main_image_url:null,category:"inputs"},{id:"mock-4",product_name:"Tractor Ploughing (Example)",price:90,location:"Marondera",main_image_url:null,category:"services"},{id:"mock-5",product_name:"Road Runner Chickens (Example)",price:6,location:"Gweru",main_image_url:null,category:"produce"},{id:"mock-6",product_name:"Veterinary Services (Example)",price:50,location:"Bulawayo",main_image_url:null,category:"services"}];function f(e,t,n,o=null,i=null){e.innerHTML="";const a=document.createElement("div");a.className="empty-state fade-in-section is-visible";const r=document.createElement("i");r.className="fa-solid fa-basket-shopping";const c=document.createElement("h3");c.textContent=t;const l=document.createElement("p");if(l.textContent=n,a.appendChild(r),a.appendChild(c),a.appendChild(l),o&&i){const e=document.createElement("button");e.className="btn btn-primary",e.textContent=o,e.onclick=i,a.appendChild(e)}e.appendChild(a)}}}});
