import{s as B,C as x,g as R,a as L}from"./app-Bv5i1KIP.js";import{handleStartChat as D}from"./chat-CCN11feI.js";const N=document.getElementById("featured-listings-grid"),k=document.getElementById("featured-loading-message"),C=document.getElementById("listings-grid-content"),S=document.getElementById("loading-message"),p=document.getElementById("listing-detail-container");document.getElementById("search-form");document.getElementById("search-input");document.getElementById("location-input");const T=document.getElementById("load-more-btn"),M=document.getElementById("breadcrumb-container");let u="produce";const y={produce:{theme:"theme-produce",title:"Recruiting Producers!",desc:"We are verifying farmers now. Register to have your produce listed here when we launch.",btnText:"Register Now",unitDefault:"crate",promo:{bgImage:"/images/field.webp",left:{title:'<i class="fa-solid fa-truck-ramp-box icon"></i>Are You a Large-Scale Buyer?',desc:"Secure your supply chain early. Contract farmers before the harvest season begins.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-tractor icon"></i>Are You a Farmer?',desc:"Don't get left behind. Join our Contract Program and get verified today.",btn:"Join Our Program"}}},inputs:{theme:"theme-inputs",title:"Recruiting Input Suppliers.",desc:"Do you sell fertilizer, seeds, or chemicals? Register now to reach thousands of farmers.",btnText:"Register as Supplier",unitDefault:"bag",promo:{bgImage:"/images/promo-inputs.jpg",left:{title:'<i class="fa-solid fa-shop icon"></i>Bulk Orders Coming Soon',desc:"We are aggregating orders from our farmers. Be the first supplier they call.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-hand-holding-dollar icon"></i>Sell Your Inputs',desc:"Create your verified profile today so you are ready when the season starts.",btn:"Register Now"}}},services:{theme:"theme-services",title:"Recruiting Service Providers.",desc:"Tractor owners, transporters, and vets: Get verified now to receive job alerts.",btnText:"Register Service",unitDefault:"job",promo:{bgImage:"/images/promo-services.jpg",left:{title:'<i class="fa-solid fa-clipboard-list icon"></i>Need Work Done?',desc:"We are building a database of verified service providers. Check back soon.",btn:"+263 78 514 1781"},right:{title:'<i class="fa-solid fa-wrench icon"></i>List Your Machinery',desc:"Turn your idle equipment into cash. Register your tractor or truck today.",btn:"Register Now"}}}},H=[{id:"mock-1",product_name:"Fresh Tomatoes (Example)",price:15,location:"Harare",main_image_url:null,category:"produce"},{id:"mock-2",product_name:"Choice Maize (Example)",price:5,location:"Bindura",main_image_url:null,category:"produce"},{id:"mock-3",product_name:"Compound D Fertilizer (Example)",price:38,location:"Msasa",main_image_url:null,category:"inputs"},{id:"mock-4",product_name:"Tractor Ploughing (Example)",price:90,location:"Marondera",main_image_url:null,category:"services"},{id:"mock-5",product_name:"Road Runner Chickens (Example)",price:6,location:"Gweru",main_image_url:null,category:"produce"},{id:"mock-6",product_name:"Veterinary Services (Example)",price:50,location:"Bulawayo",main_image_url:null,category:"services"}];function $(t,i,e,a=null,o=null){t.innerHTML="";const n=document.createElement("div");if(n.className="empty-state fade-in-section is-visible",n.innerHTML=`
    <i class="fa-solid fa-basket-shopping"></i>
    <h3>${i}</h3>
    <p>${e}</p>
  `,a&&o){const l=document.createElement("button");l.className="btn btn-primary",l.textContent=a,l.onclick=o,n.appendChild(l)}t.appendChild(n)}async function Y(){if(!C)return;const i=new URLSearchParams(window.location.search).get("cat");i&&y[i]?u=i:u="produce",console.log(`Initializing listings for category: ${u}`),P(),G(),N&&A(),U()}function P(){const t=y[u];document.body.classList.remove("theme-produce","theme-inputs","theme-services"),t.theme&&document.body.classList.add(t.theme),document.querySelectorAll(".nav-pill").forEach(n=>{n.classList.remove("active"),n.href.includes(`cat=${u}`)&&n.classList.add("active")});const i=document.getElementById("hero-title"),e=document.getElementById("hero-desc"),a=document.getElementById("hero-browse-btn");i&&(i.textContent=t.title),e&&(e.textContent=t.desc),a&&(a.textContent=t.btnText);const o=document.getElementById("promo-section");if(o&&t.promo){o.style.backgroundImage=`url('${t.promo.bgImage}')`;const n=document.getElementById("promo-left-title"),l=document.getElementById("promo-left-desc"),s=document.getElementById("promo-left-btn");n&&(n.innerHTML=t.promo.left.title),l&&(l.textContent=t.promo.left.desc),s&&(s.textContent=t.promo.left.btn,t.promo.left.btn.includes("+263")?(s.href="https://wa.me/263785141781",s.target="_blank"):(s.href="/contact.html",s.target=""));const d=document.getElementById("promo-right-title"),r=document.getElementById("promo-right-desc"),g=document.getElementById("promo-right-btn");d&&(d.innerHTML=t.promo.right.title),r&&(r.textContent=t.promo.right.desc),g&&(g.textContent=t.promo.right.btn)}}async function G(){const t=document.getElementById("location-input");t&&(t.innerHTML='<option value="">All Locations</option>')}function U(){S&&(S.style.display="none"),T&&(T.style.display="none");const t=H.filter(i=>i.category===u);if(t.length===0){$(C,"No Examples Yet","Check back soon as we verify our first partners.");return}C.innerHTML="",t.forEach(i=>{const e=document.createElement("article");e.className="listing-card fade-in-section is-visible";const a=document.createElement("a");a.href="/auth.html",a.className="listing-card-link";const o=document.createElement("img");o.src="/images/logo.webp",o.alt=i.product_name,o.style.objectFit="contain",o.style.padding="20px",o.style.backgroundColor="#f9f9f9";const n=document.createElement("div");n.className="listing-card-content";const l=document.createElement("h3");l.textContent=i.product_name;const s=document.createElement("p");s.className="price";const d=y[u];s.textContent=`$${i.price} / ${d.unitDefault}`;const r=document.createElement("div");r.style.backgroundColor="#ffc107",r.style.color="#333",r.style.fontSize="0.75rem",r.style.fontWeight="700",r.style.padding="4px 8px",r.style.borderRadius="4px",r.style.display="inline-block",r.style.marginBottom="8px",r.textContent="EXAMPLE: Register to Feature",n.appendChild(r),n.appendChild(l),n.appendChild(s),a.appendChild(o),a.appendChild(n),e.appendChild(a),C.appendChild(e)})}async function A(){k&&(k.style.display="none"),$(N,"Bulk Supply","Recruiting verified bulk suppliers. Contact us to apply.")}async function z(){var o;if(!p)return;const i=new URLSearchParams(window.location.search).get("id");if(!i){p.innerHTML='<p class="error">Listing not found. <a href="index.html">Go home</a>.</p>';return}const{data:e,error:a}=await B.from("listings").select("*, profiles ( id, full_name )").eq("id",i).single();if(a){p.innerHTML='<p class="error">Error loading listing.</p>';return}if(e){document.title=`${e.product_name} - Seed & Sell`;const n=e.category||"produce",s=(y[n]||y.produce).unitDefault;M&&(M.innerHTML=`<a href="index.html?cat=${n}">Home</a> &gt; <a href="index.html?cat=${n}#marketplace-container">${n.charAt(0).toUpperCase()+n.slice(1)}</a> &gt; <span class="current">${e.product_name}</span>`);const d=L(),r=d&&d===e.farmer_id;p.innerHTML="";const g=document.createElement("div");g.className="listing-detail-image-wrapper";const m=document.createElement("img");if(m.id="listing-image",e.main_image_url)try{const c=e.main_image_url.split(`/${x.IMAGES.BUCKET}/`)[1];if(c){const{data:b}=B.storage.from(x.IMAGES.BUCKET).getPublicUrl(c,{transform:{width:800,height:600,resize:"cover"}});m.src=b.publicUrl}else m.src=e.main_image_url}catch{m.src="/images/logo.webp"}else m.src="/images/logo.webp";m.alt=e.product_name,g.appendChild(m);const f=document.createElement("div");f.className="listing-detail-info";const E=document.createElement("h2");E.id="listing-title",E.textContent=e.product_name;const v=document.createElement("p");v.id="listing-price",v.textContent=`$${e.price} / ${s}`;const I=document.createElement("div");I.className="listing-meta-group",I.innerHTML=`
      <p class="listing-meta-item"><i class="fa-solid fa-cubes"></i> <span><strong>Available:</strong> ${e.quantity_available||"Not specified"} ${s}s</span></p>
      <p class="listing-meta-item"><i class="fa-solid fa-location-dot"></i> <span><strong>Location:</strong> ${e.location}</span></p>
    `;const _=document.createElement("div");_.className="listing-description-card",_.innerHTML=`<h3>Description</h3><p>${e.description||"No description provided."}</p>`,f.appendChild(E),f.appendChild(v),f.appendChild(I),f.appendChild(_);const w=document.createElement("div");w.className="listing-detail-sidebar";const h=document.createElement("div");if(h.className="farmer-details-card",h.innerHTML=`<h3>Seller Details</h3><p class="listing-meta-item"><i class="fa-solid fa-user"></i> <span><strong>Contact:</strong> ${((o=e.profiles)==null?void 0:o.full_name)||"Unknown"}</span></p>`,r){const c=document.createElement("a");c.href=`/dashboard.html?edit_id=${e.id}`,c.className="btn btn-primary btn-full-width",c.textContent="Edit Your Listing",h.appendChild(c)}else{const c=document.createElement("button");c.className="btn btn-primary btn-full-width",c.textContent="Chat with Seller",c.onclick=()=>{const b=R();if(!b)return alert("Please log in as a Buyer to chat.");if(b.user_role==="farmer"&&n==="produce")return alert("Farmers cannot chat with other farmers.");D(e.profiles.id,L())},h.appendChild(c)}w.appendChild(h),p.appendChild(g),p.appendChild(f),p.appendChild(w)}}export{z as initListingDetailPage,Y as initListingsPage};
