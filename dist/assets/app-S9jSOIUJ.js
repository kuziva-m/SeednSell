const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/listings-DfXaeNoR.js","assets/chat-D5le10tg.js"])))=>i.map(i=>d[i]);
(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const P="modulepreload",S=function(t){return"/"+t},B={},g=function(e,o,i){let n=Promise.resolve();if(o&&o.length>0){let a=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),h=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));n=a(o.map(c=>{if(c=S(c),c in B)return;B[c]=!0;const u=c.endsWith(".css"),m=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const l=document.createElement("link");if(l.rel=u?"stylesheet":P,u||(l.as="script"),l.crossOrigin="",l.href=c,h&&l.setAttribute("nonce",h),document.head.appendChild(l),u)return new Promise((y,p)=>{l.addEventListener("load",y),l.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return n.then(a=>{for(const r of a||[])r.status==="rejected"&&s(r.reason);return e().catch(s)})},_={SUPABASE:{URL:"https://jupbwnbhxirfvsmrqiko.supabase.co",ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1cGJ3bmJoeGlyZnZzbXJxaWtvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjQ2OTksImV4cCI6MjA3NzcwMDY5OX0.ZIskD5R-E-hJVmUGTV8O3kGW70_iXoWtlFU3M_Xr5Gc"},COMPANY_USER_ID:"fb874327-31b0-4857-81e2-75f292bc21f6",IMAGES:{BUCKET:"product_images",MAX_SIZE_BYTES:5*1024*1024,ALLOWED_TYPES:["image/jpeg","image/png"]}},{createClient:T}=supabase,d=T(_.SUPABASE.URL,_.SUPABASE.ANON_KEY);let E=null,b=null,v=null;function A(){d.auth.onAuthStateChange((t,e)=>{if(console.log("Auth event:",t),e){b=e.user.id;const o=document.getElementById("header-auth-section");if(o){o.innerHTML=`
          <div style="display: flex; align-items: center; gap: 15px;">
            <a href="/dashboard.html" class="user-avatar-btn" title="Go to Dashboard">
              <div class="avatar-circle">
                <i class="fa-solid fa-user"></i>
              </div>
              <span class="user-name-text" id="header-username">My Account</span>
            </a>
            <button id="header-logout-btn" class="action-icon" style="background: none; border: none; cursor: pointer; font-size: 1.2rem; padding: 5px;" title="Log Out">
              <i class="fa-solid fa-right-from-bracket" style="color: var(--danger-color);"></i>
            </button>
          </div>
        `;const i=document.getElementById("header-logout-btn");i&&i.addEventListener("click",()=>{const n=document.getElementById("logout-modal");n&&n.classList.add("is-visible")})}window.location.pathname.includes("auth.html")&&(window.location.href="/index.html"),k(b).then(i=>{E=i}),C(),M()}else{E=null,b=null,window.location.pathname.includes("dashboard.html")&&(window.location.href="/auth.html");const o=document.getElementById("header-auth-section");o&&(o.innerHTML='<a href="/auth.html" class="login-link">Login</a>'),v&&v.unsubscribe()}})}function O(){const t=document.getElementById("signup-form"),e=document.getElementById("login-form"),o=document.getElementById("signup-password");o&&o.addEventListener("input",i=>{const n=i.target.value,s=t?t.querySelector("button"):null;n.length>0&&n.length<6?(i.target.style.borderColor="var(--danger-color)",f("Password is too short (min 6 chars)","error"),s&&(s.disabled=!0)):(i.target.style.borderColor="#ccc",f("",""),s&&(s.disabled=!1))}),t&&t.addEventListener("submit",async i=>{i.preventDefault();const n=t.querySelector("button[type='submit']");n.disabled=!0,n.innerHTML='<span class="spinner"></span>Creating Account...';const s=document.getElementById("signup-email").value,a=document.getElementById("signup-password").value,r=document.getElementById("signup-name").value,h=document.getElementById("signup-phone").value,c=document.getElementById("signup-city").value,u=document.getElementById("signup-area").value;document.getElementById("signup-entity-type").value;const m=document.getElementById("signup-role").value,l=`${c}, ${u}`,y=x(h),{data:p,error:w}=await d.auth.signUp({email:s,password:a});if(w){f(w.message,"error"),n.disabled=!1,n.innerHTML="Sign Up";return}if(p.user){const{error:I}=await d.from("profiles").insert({id:p.user.id,full_name:r,phone_number:y,location:l,user_role:m});I?(console.error("Profile save error:",I),f("Sign up successful, but profile saving failed.","error"),n.disabled=!1,n.innerHTML="Sign Up"):(f("Sign up successful! Redirecting...","success"),window.location.href="/index.html")}}),e&&e.addEventListener("submit",async i=>{i.preventDefault();const n=e.querySelector("button[type='submit']");n.disabled=!0,n.innerHTML='<span class="spinner"></span>Logging In...';const s=document.getElementById("login-email").value,a=document.getElementById("login-password").value,{error:r}=await d.auth.signInWithPassword({email:s,password:a});r?(f(r.message,"error"),n.disabled=!1,n.innerHTML="Log In"):(f("Login successful! Redirecting...","success"),window.location.href="/index.html")})}async function k(t){const{data:e,error:o}=await d.from("profiles").select("*").eq("id",t).single();if(!o)return e}async function C(){const t=await d.auth.getUser();if(!t.data.user)return;const{data:e}=await d.rpc("get_room_unread_counts",{p_user_id:t.data.user.id});if(e&&e.length>0){const o=document.getElementById("notification-bubble"),i=document.getElementById("bottom-nav-bubble");o&&o.classList.add("active"),i&&i.classList.add("active")}}function M(){const t=L();!t||v||(v=d.channel("public:chat_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`receiver_id=eq.${t}`},()=>{const e=document.getElementById("notification-bubble"),o=document.getElementById("bottom-nav-bubble");e&&e.classList.add("active"),o&&o.classList.add("active")}).subscribe())}function f(t,e){const o=document.getElementById("auth-message");o&&(o.textContent=t,o.className=e)}function x(t){let e=t.replace(/\D/g,"");return e.startsWith("0")&&(e=e.substring(1)),e.startsWith("263")||(e="263"+e),"+"+e}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("logout-modal"),e=document.getElementById("logout-cancel-btn"),o=document.getElementById("logout-confirm-btn");t&&e&&o&&(e.addEventListener("click",()=>t.classList.remove("is-visible")),t.addEventListener("click",i=>{i.target===t&&t.classList.remove("is-visible")}),o.addEventListener("click",async()=>{await d.auth.signOut(),window.location.href="/index.html"}))});const L=()=>b,U=()=>E;function D(){const t=document.querySelectorAll(".fade-in-section");if(t.length===0)return;const e={root:null,rootMargin:"0px",threshold:.1},o=(n,s)=>{n.forEach(a=>{a.isIntersecting&&(a.target.classList.add("is-visible"),s.unobserve(a.target))})},i=new IntersectionObserver(o,e);t.forEach(n=>{i.observe(n)})}function N(){const t=document.querySelector("header");t&&window.addEventListener("scroll",()=>{window.scrollY>10?t.classList.add("is-scrolled"):t.classList.remove("is-scrolled")})}function q(){const t=document.querySelector(".mobile-nav-toggle"),e=document.getElementById("primary-navigation");if(!t||!e)return;t.addEventListener("click",()=>{const a=e.classList.contains("is-open");t.setAttribute("aria-expanded",!a),e.classList.toggle("is-open"),document.body.classList.toggle("nav-open")});const o=e.querySelectorAll("a");o.forEach(a=>{a.addEventListener("click",()=>{e.classList.contains("is-open")&&(t.setAttribute("aria-expanded",!1),e.classList.remove("is-open"),document.body.classList.remove("nav-open"))})});const i=e.querySelector(".magic-line"),n=e.querySelector("a.active");if(!i||!o.length)return;function s(a){if(!a){i.style.width="0px";return}i.style.left=`${a.offsetLeft}px`,i.style.width=`${a.offsetWidth}px`}s(n),o.forEach(a=>{a.addEventListener("mouseover",()=>s(a))}),e.addEventListener("mouseleave",()=>s(n))}async function W(){const t=document.getElementById("global-header"),e=document.getElementById("global-footer"),o=document.getElementById("global-mobile-nav"),i=[];t&&i.push(fetch("/components/header.html").then(n=>n.text()).then(n=>{t.innerHTML=n;const a=new URLSearchParams(window.location.search).get("cat")||"produce",r=t.querySelector(`.nav-pill[href*="cat=${a}"]`);r&&r.classList.add("active")})),e&&i.push(fetch("/components/footer.html").then(n=>n.text()).then(n=>{e.innerHTML=n})),o&&i.push(fetch("/components/mobile-nav.html").then(n=>n.text()).then(n=>{o.innerHTML=n;const s=window.location.pathname,a=o.querySelector(`.nav-item[href="${s}"]`);a&&a.classList.add("active")})),await Promise.all(i)}async function H(){await W(),A(),D(),q(),N(),$()}H();document.addEventListener("click",t=>{const e=t.target.closest("#mobile-menu-btn"),o=t.target.closest("#close-menu-btn"),i=document.getElementById("mobile-menu-overlay");e&&i&&(R(),i.classList.add("is-visible")),(o&&i||t.target===i)&&i.classList.remove("is-visible"),t.target.closest(".protected-link")&&(L()||(t.preventDefault(),window.location.href="/auth.html"))});function R(){const t=L(),e=U(),o=document.getElementById("menu-user-name"),i=document.getElementById("menu-auth-link");if(t){if(o.textContent=`Hi, ${(e==null?void 0:e.full_name)||"Farmer"}`,i&&(i.href="/dashboard.html",i.innerHTML='<i class="fa-solid fa-user"></i> My Dashboard'),!document.getElementById("menu-logout")){const n=document.querySelector(".mobile-menu-links");if(n){const s=document.createElement("a");s.id="menu-logout",s.href="#",s.className="menu-link",s.style.color="var(--danger-color)",s.innerHTML='<i class="fa-solid fa-right-from-bracket"></i> Log Out',s.onclick=a=>{a.preventDefault();const r=document.getElementById("logout-modal");r&&r.classList.add("is-visible"),document.getElementById("mobile-menu-overlay").classList.remove("is-visible")},n.appendChild(s)}}}else{o.textContent="Welcome, Guest",i&&(i.href="/auth.html",i.innerHTML='<i class="fa-solid fa-right-to-bracket"></i> Login / Sign Up');const n=document.getElementById("menu-logout");n&&n.remove()}}if("serviceWorker"in navigator){let t=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{t||(t=!0,window.location.reload())})}async function $(){const t=window.location.pathname;try{if(t.endsWith("/")||t.endsWith("/index.html")){const{initListingsPage:e}=await g(async()=>{const{initListingsPage:i}=await import("./listings-DfXaeNoR.js");return{initListingsPage:i}},__vite__mapDeps([0,1])),{initToggleSlider:o}=await g(async()=>{const{initToggleSlider:i}=await import("./toggle-B7ZfKfrR.js");return{initToggleSlider:i}},[]);e(),o()}else if(t.endsWith("/listing.html")){const{initListingDetailPage:e}=await g(async()=>{const{initListingDetailPage:o}=await import("./listings-DfXaeNoR.js");return{initListingDetailPage:o}},__vite__mapDeps([0,1]));e()}else if(t.endsWith("/dashboard.html")){const{initDashboardPage:e}=await g(async()=>{const{initDashboardPage:o}=await import("./dashboard-4JteYSEl.js");return{initDashboardPage:o}},[]);e()}else if(t.endsWith("/messages.html")){const{initChatPage:e}=await g(async()=>{const{initChatPage:o}=await import("./chat-D5le10tg.js");return{initChatPage:o}},[]);e()}else t.endsWith("/auth.html")&&O()}catch(e){console.error("Page logic error:",e)}}window.showToast=function(t,e="info"){let o=document.getElementById("toast-container");o||(o=document.createElement("div"),o.id="toast-container",document.body.appendChild(o));const i=document.createElement("div");i.className=`toast ${e}`;let n=e==="success"?"fa-circle-check":e==="error"?"fa-triangle-exclamation":"fa-circle-info";i.innerHTML=`<i class="fa-solid ${n}"></i> <span>${t}</span>`,o.appendChild(i),setTimeout(()=>{i.style.animation="fadeOutToast 0.3s forwards",i.addEventListener("animationend",()=>i.remove())},4e3)};export{_ as C,L as a,M as b,C as c,U as g,d as s};
